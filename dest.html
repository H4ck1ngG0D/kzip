<!DOCTYPE html>
<html lang="ja">
<head>
Â  <meta charset="UTF-8">
Â  <title>WAV Destroyer</title>
Â  <style>
Â  Â  body { font-family: sans-serif; padding: 2em; }
Â  Â  #log { background: #111; color: #0f0; padding: 1em; margin-top: 1em; white-space: pre-wrap; font-size: 14px; }
Â  </style>
</head>
<body>
Â  <h1>ğŸ’¥ WAV çˆ†éŸ³ç ´å£Šãƒ„ãƒ¼ãƒ«</h1>
Â  <input type="file" id="fileInput" accept=".wav">
Â  <button id="processBtn">ç ´å£Šã™ã‚‹</button>
Â  <a id="downloadLink" style="display:none;">ğŸ”Š ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>

Â  <div id="log"></div>

Â  <script>
Â  Â  function clamp(x, min, max) {
Â  Â  Â  return Math.max(min, Math.min(max, x));
Â  Â  }

Â  Â  function log(msg) {
Â  Â  Â  const logBox = document.getElementById('log');
Â  Â  Â  logBox.textContent += msg + '\n';
Â  Â  }

Â  Â  document.getElementById('processBtn').onclick = async () => {
Â  Â  Â  const fileInput = document.getElementById('fileInput');
Â  Â  Â  const logBox = document.getElementById('log');
Â  Â  Â  logBox.textContent = ""; // clear log

Â  Â  Â  if (!fileInput.files[0]) return alert("WAVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");

Â  Â  Â  log("ğŸ”„ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­...");
Â  Â  Â  const arrayBuffer = await fileInput.files[0].arrayBuffer();
Â  Â  Â  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
Â  Â  Â  const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);

Â  Â  Â  log("ğŸ§ ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‡ã‚³ãƒ¼ãƒ‰å®Œäº†ã€‚å‡¦ç†é–‹å§‹...");

Â  Â  Â  const numChannels = audioBuffer.numberOfChannels;
Â  Â  Â  const length = audioBuffer.length;
Â  Â  Â  const sampleRate = audioBuffer.sampleRate;
Â  Â  Â  const newBuffer = audioCtx.createBuffer(numChannels, length, sampleRate);

Â  Â  Â  for (let ch = 0; ch < numChannels; ch++) {
Â  Â  Â  Â  const inputData = audioBuffer.getChannelData(ch);
Â  Â  Â  Â  const outputData = newBuffer.getChannelData(ch);

Â  Â  Â  Â  log(`ğŸ’£ ãƒãƒ£ãƒ³ãƒãƒ«${ch + 1} å‡¦ç†ä¸­...`);
Â  Â  Â  Â  for (let i = 0; i < inputData.length; i++) {
Â  Â  Â  Â  Â  let sample = inputData[i];

Â  Â  Â  Â  Â  sample *= 1e12; // ğŸ’¥ çˆ†éŸ³å¢—å¹…
Â  Â  Â  Â  Â  sample += (Math.random() * 2 - 1) * 2.0; // ğŸ’€ ãƒã‚¤ã‚º
Â  Â  Â  Â  Â  const r = Math.random();
Â  Â  Â  Â  Â  if (r < 0.05) sample = -sample;
Â  Â  Â  Â  Â  else if (r < 0.08) sample = 0;
Â  Â  Â  Â  Â  else if (r < 0.10) sample *= 1000;

Â  Â  Â  Â  Â  sample = Math.sign(sample) * Math.pow(Math.abs(sample), 0.6);
Â  Â  Â  Â  Â  outputData[i] = clamp(sample, -1, 1);
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  log("ğŸ“¦ WAVã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä¸­...");

Â  Â  Â  function encodeWAV(audioBuffer) {
Â  Â  Â  Â  const numChannels = audioBuffer.numberOfChannels;
Â  Â  Â  Â  const sampleRate = audioBuffer.sampleRate;
Â  Â  Â  Â  const length = audioBuffer.length;
Â  Â  Â  Â  const interleaved = new Float32Array(length * numChannels);

Â  Â  Â  Â  for (let ch = 0; ch < numChannels; ch++) {
Â  Â  Â  Â  Â  const channelData = audioBuffer.getChannelData(ch);
Â  Â  Â  Â  Â  for (let i = 0; i < length; i++) {
Â  Â  Â  Â  Â  Â  interleaved[i * numChannels + ch] = channelData[i];
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const buffer = new ArrayBuffer(44 + interleaved.length * 2);
Â  Â  Â  Â  const view = new DataView(buffer);

Â  Â  Â  Â  function writeString(offset, str) {
Â  Â  Â  Â  Â  for (let i = 0; i < str.length; i++) {
Â  Â  Â  Â  Â  Â  view.setUint8(offset + i, str.charCodeAt(i));
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  writeString(0, 'RIFF');
Â  Â  Â  Â  view.setUint32(4, 36 + interleaved.length * 2, true);
Â  Â  Â  Â  writeString(8, 'WAVE');
Â  Â  Â  Â  writeString(12, 'fmt ');
Â  Â  Â  Â  view.setUint32(16, 16, true);
Â  Â  Â  Â  view.setUint16(20, 1, true);
Â  Â  Â  Â  view.setUint16(22, numChannels, true);
Â  Â  Â  Â  view.setUint32(24, sampleRate, true);
Â  Â  Â  Â  view.setUint32(28, sampleRate * numChannels * 2, true);
Â  Â  Â  Â  view.setUint16(32, numChannels * 2, true);
Â  Â  Â  Â  view.setUint16(34, 16, true);
Â  Â  Â  Â  writeString(36, 'data');
Â  Â  Â  Â  view.setUint32(40, interleaved.length * 2, true);

Â  Â  Â  Â  let offset = 44;
Â  Â  Â  Â  for (let i = 0; i < interleaved.length; i++) {
Â  Â  Â  Â  Â  const s = Math.max(-1, Math.min(1, interleaved[i]));
Â  Â  Â  Â  Â  view.setInt16(offset, s * 32767, true);
Â  Â  Â  Â  Â  offset += 2;
Â  Â  Â  Â  }

Â  Â  Â  Â  return new Blob([view], { type: 'audio/wav' });
Â  Â  Â  }

Â  Â  Â  const wavBlob = encodeWAV(newBuffer);
Â  Â  Â  const url = URL.createObjectURL(wavBlob);
Â  Â  Â  const link = document.getElementById('downloadLink');
Â  Â  Â  link.href = url;
Â  Â  Â  link.download = 'destroyed_MAX.wav';
Â  Â  Â  link.style.display = 'inline';
Â  Â  Â  link.textContent = 'ğŸ§ å®Œå…¨ç ´å£ŠWAVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰';

Â  Â  Â  log("âœ… å®Œäº†ï¼çˆ†éŸ³WAVã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ï¼");
Â  Â  };
Â  </script>
</body>
</html>

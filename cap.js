// cap.js

const API_BASE = "https://9f941ca98f60-2000.shironekousercontent.paicha.dev";

export function initCaptcha(containerId, options = {}) {
    const container = document.getElementById(containerId);
    if (!container) return console.error("CAPTCHA container not found");

    let currentSession = null;
    let selectedAnswer = null;

    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.disabled = true;
    checkbox.id = `${containerId}-checkbox`;

    const label = document.createElement('label');
    label.appendChild(checkbox);
    label.append(" 私はロボットではありません");
    container.appendChild(label);

    const captchaBox = document.createElement('div');
    captchaBox.style.display = 'none';
    container.appendChild(captchaBox);

    const messageBox = document.createElement('div');
    messageBox.style.marginTop = '10px';
    messageBox.style.fontSize = '12px';
    container.appendChild(messageBox);

    fetch(`${API_BASE}/api/captcha/check`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            if (data.success) {
                checkbox.disabled = false;
                checkbox.checked = true;
                captchaBox.style.display = 'block';
                loadCaptcha();
            } else {
                messageBox.textContent = data.message || "ブロックされました";
            }
        })
        .catch(() => {
            messageBox.textContent = "初期チェックに失敗しました";
        });

    function loadCaptcha() {
        fetch(`${API_BASE}/api/captcha`)
            .then(res => res.json())
            .then(data => {
                currentSession = data.session_id;
                selectedAnswer = null;
                captchaBox.innerHTML = '';

                const img = document.createElement('img');
                img.src = 'data:image/png;base64,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';
                img.alt = 'CAPTCHA';
                img.style.margin = '10px 0';
                captchaBox.appendChild(img);

                const choicesDiv = document.createElement('div');
                data.choices.forEach(choice => {
                    const btn = document.createElement('button');
                    btn.textContent = choice;
                    btn.style.margin = '5px';
                    btn.onclick = () => {
                        selectedAnswer = choice;
                        document.querySelectorAll(`#${containerId} .captcha-choice`).forEach(el => el.style.background = '');
                        btn.style.background = '#007bff';
                        btn.style.color = '#fff';
                        btn.classList.add('captcha-choice');
                    };
                    choicesDiv.appendChild(btn);
                });
                captchaBox.appendChild(choicesDiv);

                const refreshBtn = document.createElement('button');
                refreshBtn.textContent = '更新';
                refreshBtn.onclick = loadCaptcha;
                refreshBtn.style.marginTop = '10px';
                captchaBox.appendChild(refreshBtn);

                const verifyBtn = document.createElement('button');
                verifyBtn.textContent = '認証';
                verifyBtn.onclick = verifyCaptcha;
                verifyBtn.style.marginLeft = '10px';
                captchaBox.appendChild(verifyBtn);
            });
    }

    function verifyCaptcha() {
        if (!selectedAnswer) {
            messageBox.textContent = "選択してください";
            return;
        }

        fetch(`${API_BASE}/api/captcha/verify`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                session_id: currentSession,
                answer: selectedAnswer
            })
        })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    messageBox.textContent = '✅ 認証成功！';
                    if (options.onSuccess) options.onSuccess(data.token);
                } else {
                    messageBox.textContent = '❌ ' + (data.message || '認証失敗');
                    loadCaptcha();
                }
            })
            .catch(() => {
                messageBox.textContent = "認証エラー";
            });
    }
}
